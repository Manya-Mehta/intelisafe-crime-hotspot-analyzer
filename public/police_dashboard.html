<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Police Crime Analytics Dashboard</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
      color: #ffffff;
      min-height: 100vh;
      overflow-x: hidden;
    }

    .container { max-width: 1400px; margin: 0 auto; padding: 20px; }

    .header { text-align: center; margin-bottom: 40px; position: relative; overflow: hidden; }
    .header::before {
      content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
      background: radial-gradient(circle, rgba(0,123,255,0.1) 0%, transparent 50%);
      animation: rotate 20s linear infinite;
    }
    @keyframes rotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg);} }
    .header h1 {
      font-size: 3rem; font-weight: 700;
      background: linear-gradient(45deg, #00d4ff, #007bff, #6610f2);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text; margin-bottom: 10px; position: relative; z-index: 2;
    }
    .header .subtitle { font-size: 1.2rem; opacity: 0.8; position: relative; z-index: 2; }

    .nav-tabs {
      display: flex; justify-content: center; margin-bottom: 40px;
      background: rgba(255,255,255,0.05); border-radius: 50px; padding: 8px;
      backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1);
    }
    .nav-tab {
      padding: 15px 30px; border: none; background: transparent; color: #fff; cursor: pointer;
      border-radius: 40px; font-size: 1rem; font-weight: 500; transition: all .3s ease;
      position: relative; overflow: hidden;
    }
    .nav-tab::before {
      content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
      background:linear-gradient(45deg, #007bff, #00d4ff); transition:left .3s ease; z-index:-1;
    }
    .nav-tab.active::before { left:0; }
    .nav-tab:hover { transform: translateY(-2px); box-shadow:0 10px 20px rgba(0,123,255,.3);}
    .nav-tab.active { color:#fff; box-shadow:0 10px 30px rgba(0,123,255,.4); }

    .tab-content { display:none; animation: fadeIn .5s ease; }
    .tab-content.active { display:block; }
    @keyframes fadeIn { from{opacity:0;transform:translateY(20px);} to{opacity:1;transform:translateY(0);} }

    .card {
      background:rgba(255,255,255,.05); border-radius:20px; padding:30px; margin-bottom:30px;
      backdrop-filter:blur(10px); border:1px solid rgba(255,255,255,.1); transition:.3s ease;
      position:relative; overflow:hidden;
    }
    .card::before {
      content:''; position:absolute; top:0; left:-100%; width:100%; height:2px;
      background:linear-gradient(90deg, #007bff, #00d4ff, #6610f2); transition:left .3s ease;
    }
    .card:hover::before { left:0; }
    .card:hover { transform:translateY(-5px); box-shadow:0 20px 40px rgba(0,123,255,.2); }
    .card h2 { font-size:1.8rem; margin-bottom:20px; color:#00d4ff; }

    .map-container {
      height: 500px;
      border-radius: 15px;
      border: 2px solid rgba(0,123,255,0.3);
      overflow: hidden;
    }
    #map { height:100%; width:100%; }

    .filter-section {
      display:grid; grid-template-columns:repeat(auto-fit, minmax(200px,1fr));
      gap:20px; margin-bottom:30px;
    }
    .filter-group { background:rgba(255,255,255,.05); padding:20px; border-radius:15px; border:1px solid rgba(255,255,255,.1);}
    .filter-group label { display:block; margin-bottom:10px; color:#00d4ff; font-weight:500; }
    .filter-input {
      width:100%; padding:12px; border:2px solid rgba(0,123,255,.3); border-radius:10px;
      background:rgba(255,255,255,.05); color:#fff; font-size:1rem; transition:.3s;
    }
    .filter-input:focus { outline:none; border-color:#00d4ff; box-shadow:0 0 15px rgba(0,212,255,.3); }

    .btn {
      padding:12px 25px; border:none; border-radius:25px; font-size:1rem; font-weight:600;
      cursor:pointer; transition:.3s ease; position:relative; overflow:hidden; text-transform:uppercase;
      letter-spacing:1px;
    }
    .btn-primary { background:linear-gradient(45deg,#007bff,#00d4ff); color:#fff; }
    .btn-success { background:linear-gradient(45deg,#28a745,#20c997); color:#fff; }
    .btn:hover { transform:translateY(-3px); box-shadow:0 15px 30px rgba(0,123,255,.4); }
    .btn::before {
      content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);
      transition:left .5s ease;
    }
    .btn:hover::before { left:100%; }

    .stats-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; margin-bottom:30px;}
    .stat-card {
      background:rgba(255,255,255,.05); padding:25px; border-radius:15px; text-align:center;
      border:1px solid rgba(255,255,255,.1); transition:.3s; position:relative; overflow:hidden;
    }
    .stat-card::before {
      content:''; position:absolute; top:0; left:0; right:0; height:3px;
      background:linear-gradient(90deg,#007bff,#00d4ff,#6610f2,#007bff);
      background-size:300% 100%; animation:gradientMove 3s ease-in-out infinite;
    }
    @keyframes gradientMove { 0%,100%{background-position:0% 0%;} 50%{background-position:100% 0%;} }
    .stat-card:hover { transform:translateY(-5px); box-shadow:0 15px 30px rgba(0,123,255,.2); }
    .stat-number { font-size:2.5rem; font-weight:700; color:#00d4ff; margin-bottom:10px; }
    .stat-label { font-size:1rem; opacity:.8; text-transform:uppercase; letter-spacing:1px; }

    .hotspot-list { max-height:400px; overflow-y:auto; padding-right:10px; }
    .hotspot-item {
      background:rgba(255,255,255,.05); padding:20px; border-radius:12px; margin-bottom:15px;
      border-left:4px solid #00d4ff; transition:.3s ease; cursor:pointer;
    }
    .hotspot-item:hover { background:rgba(0,123,255,.1); transform:translateX(10px); }
    .hotspot-rank { font-size:1.5rem; font-weight:700; color:#00d4ff; margin-bottom:5px; }
    .hotspot-location { font-size:1.1rem; margin-bottom:5px; }
    .hotspot-incidents { font-size:.9rem; opacity:.7; }

    @media(max-width:768px){
      .header h1{font-size:2rem;} .nav-tabs{flex-direction:column;} .nav-tab{margin-bottom:10px;}
      .card{padding:20px;} .map-container{height:300px;}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>InteliSafe</h1>
      <p class="subtitle">Police Crime Analytics Dashboard</p>
    </div>

    <div class="nav-tabs">
      <button class="nav-tab active" onclick="switchTab('hotspot-map')">üó∫Ô∏è Hotspot Map</button>
      <button class="nav-tab" onclick="switchTab('filters')">üîç Filters</button>
      <button class="nav-tab" onclick="switchTab('data-export')">üìä Data Export</button>
    </div>

    <!-- Hotspot Map Tab -->
    <div id="hotspot-map" class="tab-content active">
      <div class="stats-grid">
        <div class="stat-card"><div class="stat-number" id="total-incidents">1,247</div><div class="stat-label">Total Incidents</div></div>
        <div class="stat-card"><div class="stat-number" id="active-hotspots">23</div><div class="stat-label">Active Hotspots</div></div>
        <div class="stat-card"><div class="stat-number" id="resolved-cases">892</div><div class="stat-label">Resolved Cases</div></div>
        <div class="stat-card"><div class="stat-number" id="response-time">4.2m</div><div class="stat-label">Avg Response</div></div>
      </div>

      <div style="display:grid; grid-template-columns:2fr 1fr; gap:30px;">
        <div class="card">
          <h2>üó∫Ô∏è Crime Hotspot Map</h2>
          <div class="map-container">
            <div id="map"></div>
          </div>
        </div>

        <div class="card">
          <h2>üî• Top Hotspots</h2>
          <div class="hotspot-list">
            <div class="hotspot-item"><div class="hotspot-rank">#1</div><div class="hotspot-location">Downtown District</div><div class="hotspot-incidents">156 incidents this month</div></div>
            <div class="hotspot-item"><div class="hotspot-rank">#2</div><div class="hotspot-location">Industrial Area</div><div class="hotspot-incidents">134 incidents this month</div></div>
            <div class="hotspot-item"><div class="hotspot-rank">#3</div><div class="hotspot-location">University Campus</div><div class="hotspot-incidents">98 incidents this month</div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters Tab -->
    <div id="filters" class="tab-content">
      <div class="card">
        <h2>üîç Filter Crime Hotspots</h2>
        <div class="filter-section">
          <div class="filter-group"><label for="top-n">Top N Hotspots:</label><input type="number" id="top-n" class="filter-input" value="10" min="1" max="100"/></div>
          <div class="filter-group"><label for="date-range">Date Range:</label><input type="date" id="date-from" class="filter-input" style="margin-bottom:10px;"/><input type="date" id="date-to" class="filter-input"/></div>
          <div class="filter-group"><label for="crime-type">Crime Type:</label><select id="crime-type" class="filter-input"><option value="">All Types</option><option value="theft">Theft</option><option value="assault">Assault</option></select></div>
        </div>
        <button class="btn btn-primary" onclick="applyFilters()">Apply Filters</button>
      </div>
    </div>

    <!-- Data Export Tab -->
    <div id="data-export" class="tab-content">
      <div class="card">
        <h2>üìä Download Crime Data</h2>
        <button class="btn btn-success" onclick="downloadData('csv')">üì• Download CSV</button>
        <button class="btn btn-success" onclick="downloadData('json')">üì• Download JSON</button>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

<script>
// Tab Switching
function switchTab(tabName,event){
    document.querySelectorAll('.tab-content').forEach(tc=>tc.classList.remove('active'));
    document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));
    document.getElementById(tabName).classList.add('active');
    if(event) event.target.classList.add('active');
}

// Initialize Map
let map;
let heatLayer;
function initMap(){
    map = L.map('map').setView([21.1702, 72.8311], 12); // Default: Surat
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
    loadHotspots();
}

// Load Hotspots & Markers
async function loadHotspots(){
    try{
        const res = await fetch('/api/reports');  // <-- fetch from reports API
        const reports = await res.json();

        if(!reports.length) return;

        if(heatLayer) heatLayer.remove();

        const heatPoints = reports.map(r=>{
            if(r.latitude && r.longitude) return [r.latitude, r.longitude, r.severity || 1];
            return null;
        }).filter(Boolean);

        heatLayer = L.heatLayer(heatPoints, {radius: 25, blur: 15, maxZoom: 17}).addTo(map);

        const hotspotSet = new Set();
        reports.forEach(r=>{
            if(r.latitude && r.longitude){
                L.marker([r.latitude, r.longitude])
                 .addTo(map)
                 .bindPopup(`<b>${r.crimeType}</b><br>${r.locationDesc || 'Unknown'}<br>
                             Date: ${r.incidentDate ? new Date(r.incidentDate).toLocaleString() : ''}<br>
                             Status: ${r.status || 'pending'}`);
                hotspotSet.add(r.locationDesc || 'Unknown');
            }
        });

        document.getElementById('total-incidents').textContent = reports.length;
        document.getElementById('active-hotspots').textContent = hotspotSet.size;

    }catch(err){
        console.error("Error loading reports:", err);
    }
}

// Apply filters placeholder
function applyFilters(){ console.log("Filters applied"); }

// Download mock
function downloadData(format){
    const blob = new Blob([JSON.stringify({sample:"data"}, null,2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a"); a.href=url; a.download=`crime-data.${format}`; a.click();
    URL.revokeObjectURL(url);
}

// Init on DOM ready
document.addEventListener('DOMContentLoaded', ()=>{
    initMap();
});
</script>


</body>
</html>
